<mat-form-field style="padding-left: 50px;">
	<input matInput (keyup)="applyFilter($any($event.target).value)" placeholder="Filter">
</mat-form-field>

<table mat-table [dataSource]="dataSource" multiTemplateDataRows class="mat-elevation-z8" matSort>

    <ng-container matColumnDef="{{column}}" *ngFor="let column of columnsToDisplay">
		<ng-container *ngIf="column !== 'action'; else action">
            <th mat-header-cell *matHeaderCellDef mat-sort-header><b> {{getColumnLabel(column)}} </b></th>
            <td mat-cell *matCellDef="let element" [innerHTML]="getColumnContent(element,column)"> </td>    
        </ng-container>
        <ng-template #action>
            <th mat-header-cell *matHeaderCellDef> </th>
            <td mat-cell *matCellDef="let element">
              <mat-icon (click)="expandedElement = expandedElement === element ? null : element">{{expandedElement === element ? 'swap_vertical_circle' : 'swap_vertical_circle'}}</mat-icon>
            </td>
          </ng-template>
	</ng-container>

    



	<!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
	<ng-container matColumnDef="expandedDetail">
		<td mat-cell *matCellDef="let element2" [attr.colspan]="columnsToDisplay.length">
			<div class="example-element-detail" *ngIf="element2.procedures?.data.length" [@detailExpand]="isExpanded(element2)">
				<div class="inner-table mat-elevation-z8" *ngIf="isExpanded(element2)">

					<table #innerTables mat-table [dataSource]="element2.procedures" multiTemplateDataRows matSort>
						<ng-container matColumnDef="{{innerColumn}}" *ngFor="let innerColumn of innerDisplayedColumns">
							<ng-container *ngIf="innerColumn !== 'action'; else action">
                            	<th mat-header-cell *matHeaderCellDef mat-sort-header> {{getColumnLabel(innerColumn)}} </th>
                            	<td mat-cell *matCellDef="let element2" (click)="toggleAddress(element2)" [innerHTML]="getColumnContent(element2,innerColumn)"> 
									
								</td>    
							</ng-container>
							<ng-template #action>
								<th mat-header-cell *matHeaderCellDef> </th>
								<td mat-cell *matCellDef="let element2">
							  	<mat-icon (click)="expandedElement2 = expandedElement2 === element2 ? null : element2">{{expandedElement2 === element2 ? 'swap_vertical_circle' : 'swap_vertical_circle'}}</mat-icon>
								</td>
						  	</ng-template>
						</ng-container>
						<ng-container matColumnDef="innerExpandedDetail">
							<td mat-cell *matCellDef="let element3" [attr.colspan]="displayedCommentColumns.length">
								<div class="inner-table2 mat-elevation-z8" *ngIf="innerExpandedElements.includes(element3)">
									<table #bpiTables *ngIf="innerExpandedElements.includes(element3)" mat-table  [dataSource]="element3.BPIs" matSort>
										<ng-container  matColumnDef="{{commentColumn}}" *ngFor="let commentColumn of displayedCommentColumns">
											<th mat-header-cell *matHeaderCellDef mat-sort-header> {{getColumnLabel(commentColumn)}} </th>
											<td mat-cell *matCellDef="let com_element"  [innerHTML]="getColumnContent(com_element,commentColumn)"> 

											</td>
										</ng-container>
										<tr mat-header-row *matHeaderRowDef="displayedCommentColumns"></tr>
										<tr mat-row *matRowDef="let row; columns: displayedCommentColumns;"  [class.example-element-row3]="element2.procedures?.data.length" [class.example-expanded-row3]="expandedElement === element2"></tr>
									</table>
								</div>
							</td>
						</ng-container>
						<tr mat-header-row *matHeaderRowDef="innerDisplayedColumns"></tr>
						<tr mat-row *matRowDef="let row; columns: innerDisplayedColumns;" [class.example-element-row2]="element2.procedures?.data.length" [class.example-expanded-row2]="expandedElement === element2"></tr>
						<tr mat-row *matRowDef="let row; columns: ['innerExpandedDetail']" class="example-detail-row"></tr>
						
					</table>
				</div>
			</div>
		</td>
	</ng-container>

	<tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
	<tr mat-row *matRowDef="let element; columns: columnsToDisplay;"
		[class.example-element-row]="element.procedures?.data.length" [class.example-expanded-row]="expandedElement === element"
		(click)="toggleRow(element)">
	</tr>
	<tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
</table>

